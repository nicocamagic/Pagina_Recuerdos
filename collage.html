<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba collage</title>
    <link rel="stylesheet" href="collage.css">
</head>
<body>
    <div class="container collage1">
        <div class="grid-container">
            <div class="item item1">
                <img src="IMG/Img_Pablo/2.jpg" alt="image">
            </div>
            <div class="item item2">
                <img src="IMG/Img_Pablo/5.jpg" alt="image">
            </div>
            <div class="item item3">
                <img src="IMG/Img_Pablo/7.jpg" alt="image">
            </div>
            <div class="item item4">
                <img src="IMG/Img_Pablo/9.jpg" alt="image">
            </div>
            <div class="item item5">
                <img src="IMG/Img_Pablo/10.jpg" alt="image">
            </div>
            <div class="item item6">
                <img src="IMG/Img_Pablo/11.jpg" alt="image">
            </div>
            <div class="item item7">
                <img src="IMG/Img_Pablo/12.jpg" alt="image">
            </div>
        </div>
    </div>    

    <!-- animation overlay -->
    <div id="animOverlay">
        <img id="animImg" src="" alt="" />
        <button id="skipBtn" type="button">Saltar animaci√≥n</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const items = document.querySelectorAll('.grid-container .item img');
            const overlay = document.getElementById('animOverlay');
            const animImg = document.getElementById('animImg');
            const skipBtn = document.getElementById('skipBtn');
            const collageContainer = document.querySelector('.container');
            let skipRequested = false;

            // hide collage initially
            collageContainer.style.opacity = '0';

            const sources = Array.from(items).map(img => img.src);

            // ensure we show 100 frames by repeating the list if needed
            const targetCount = 100;
            let sequence = [];
            for (let i = 0; i < targetCount; i++) {
                sequence.push(sources[i % sources.length]);
            }

            // slower, fixed animation timing for more nostalgia
            let displayTime = 4000; // 4s per photo

            function randomPosition(el) {
                const vw = window.innerWidth;
                const vh = window.innerHeight;
                const w = el.offsetWidth;
                const h = el.offsetHeight;
                const left = Math.random() * (vw - w);
                const top = Math.random() * (vh - h);
                el.style.left = left + 'px';
                el.style.top = top + 'px';
            }

            function endAnimation() {
                skipRequested = true;
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    collageContainer.style.transition = 'opacity 1s';
                    collageContainer.style.opacity = '1';
                    populateCollage();
                }, 500);
            }

            function populateCollage() {
                // Recreate the original grid layout with 7 items
                const containerGrid = document.querySelector('.grid-container');
                containerGrid.classList.remove('final');
                containerGrid.innerHTML = '';

                // Re-add original 7 items with their classes
                const positions = [
                    {class: 'item1', src: sources[0]},
                    {class: 'item2', src: sources[1]},
                    {class: 'item3', src: sources[2]},
                    {class: 'item4', src: sources[3]},
                    {class: 'item5', src: sources[4]},
                    {class: 'item6', src: sources[5]},
                    {class: 'item7', src: sources[6]},
                    {class: 'item8', src: sources[6]},
                    {class: 'item9', src: sources[6]},
                    {class: 'item10', src: sources[6]},
                    {class: 'item11', src: sources[6]},
                    {class: 'item12', src: sources[6]},
                    {class: 'item13', src: sources[6]},
                    {class: 'item14', src: sources[6]},
                    {class: 'item15', src: sources[6]},
                    {class: 'item16', src: sources[6]},
                    {class: 'item17', src: sources[6]},
                    {class: 'item18', src: sources[6]},
                    {class: 'item19', src: sources[6]},
                    {class: 'item20', src: sources[6]},
                    {class: 'item21', src: sources[6]},
                    {class: 'item22', src: sources[6]},
                ];

                positions.forEach(pos => {
                    const div = document.createElement('div');
                    div.className = `item ${pos.class}`;
                    const img = document.createElement('img');
                    img.src = pos.src;
                    div.appendChild(img);
                    containerGrid.appendChild(div);
                });
            }

            skipBtn.addEventListener('click', endAnimation);

            function showImage(index) {
                if (skipRequested || index >= sequence.length) {
                    endAnimation();
                    return;
                }

                animImg.src = sequence[index];
                // clear previous position
                animImg.style.left = '';
                animImg.style.top = '';

                // when image is loaded, randomize and fade
                animImg.onload = () => {
                    randomPosition(animImg);
                    overlay.classList.add('visible');

                    // after displayTime fade out
                    setTimeout(() => {
                        overlay.classList.remove('visible');
                    }, displayTime);

                    // schedule next image slightly after fade out begins
                    setTimeout(() => {
                        showImage(index + 1);
                    }, displayTime + 500);
                };
            }

            // start sequence
            showImage(0);
        });
    </script>
</body>
</html>